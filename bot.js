const Discord = require('discord.js');
const client = new Discord.Client();
const fs = require("fs"); 
const Canvas = require("canvas");
const jimp = require("jimp");
   let points = {}
   
const prefix = '_'
  

client.on('message', message => {
      if(message.author.bot) return;
if (message.content.startsWith(prefix + 'top')) {
    let _top = 1;
     let topp = Object.values(points);
 let top = topp.slice(0, 10).map(users => `**\`.${_top++}\` | <@${users.id}> \`XP: ${users.points}\`**`).sort((a, b) => a > b).join('\n');
    const prefixlor = new Discord.RichEmbed()
      .setTitle("Leaderboard")
      .setAuthor(client.user.username, client.user.avatarURL)
      .setDescription(top,true)
   
  	message.channel.sendEmbed(prefixlor)
}
  
});

client.on('message', message => {
      if(message.author.bot) return;
if (message.content.startsWith(prefix + 'Ù†Ù‚Ø§Ø·ÙŠ')) {
	if(!message.channel.guild) return message.reply('**Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ø³ÙŠØ±ÙØ±Ø§Øª ÙÙ‚Ø·**').then(m => m.delete(3000));
	let userData = points[message.author.id];
	let embed = new Discord.RichEmbed()
    .setAuthor(`${message.author.tag}`, message.author.avatarURL)
	.setColor('#000000')
	.setDescription(`Ù†Ù‚Ø§Ø·Ùƒ: \`${userData.points}\``)
	message.channel.sendEmbed(embed)
  }
});
client.on('message', message => {
  if(message.author.bot) return;
if (message.content.startsWith(prefix + 'points')) {
if(!message.channel.guild) return message.reply('**Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ù„Ù„Ø³ÙŠØ±ÙØ±Ø§Øª ÙÙ‚Ø·**').then(m => m.delete(3000));
let userData = points[message.author.id];
let embed = new Discord.RichEmbed()
.setAuthor(`${message.author.tag}`, message.author.avatarURL)
.setColor('#000000')
.setDescription(`  points:    \`${userData.points}\`   `)
message.channel.sendEmbed(embed)
}
});



   

client.on('message' , message => {
  if(message.author.bot) return;
  if(message.content.startsWith(prefix + "vs")) {
 let array_of_mentions = message.mentions.users.array();
  let symbols = [':o:', ':heavy_multiplication_x:']
  var grid_message;
 
  if (array_of_mentions.length == 1 || array_of_mentions.length == 2) {
    let random1 = Math.floor(Math.random() * (1 - 0 + 1)) + 0;
    let random2 = Math.abs(random1 - 1);
    if (array_of_mentions.length == 1) {
      random1 = 0;
      random2 = 0;
    }
    var player1_id = message.author.id
    let player2_id = array_of_mentions[random2].id;
    var turn_id = player1_id;
    let initial_message = `Ø§Ù„ØªØ®Ø¯ÙŠ Ø¨ÙŠÙ†  <@${player1_id}> vs <@${player2_id}>!`;
    if (player1_id == player2_id) {
    }
    message.channel.send(`vs ${initial_message}`)
    .then(console.log("Successful tictactoe introduction"))
    .catch(console.error);
    message.channel.send(':BrawlHalla:')
    .then((new_message) => {
      grid_message = new_message;
    })
    .then(console.log("Successful tictactoe game initialization"))
    .catch(console.error);
    message.channel.send('Please wait for the end 1 v 1')
    .then(async (new_message) => {
      await new_message.react(':vs:');
      })
    .then(console.log("Successful tictactoe react initialization"))
    .catch(console.error);
  }
  else {
    message.channel.send(`Ø¬Ø±Ø¨ _vs @uesr`)
    .then(console.log("Successful error reply"))
    .catch(console.error);
  }
}
 });  

client.on("message", function(message) {
    var prefix = "#";
   if(message.content.startsWith(prefix + "rps")) {
    let messageArgs = message.content.split(" ").slice(1).join(" ");
    let messageRPS = message.content.split(" ").slice(2).join(" ");
    let arrayRPS = ['**# - Rock**','**# - Paper**','**# - Scissors**'];
    let result = `${arrayRPS[Math.floor(Math.random() * arrayRPS.length)]}`;
    var RpsEmbed = new Discord.RichEmbed()
    .setAuthor(message.author.username)
    .setThumbnail(message.author.avatarURL)
    .addField("Rock","ğŸ‡·",true)
    .addField("Paper","ğŸ‡µ",true)
    .addField("Scissors","ğŸ‡¸",true)
    message.channel.send(RpsEmbed).then(msg => {
        msg.react(' ğŸ‡·')
        msg.react("ğŸ‡¸")
        msg.react("ğŸ‡µ")
.then(() => msg.react('ğŸ‡·'))
.then(() =>msg.react('ğŸ‡¸'))
.then(() => msg.react('ğŸ‡µ'))
let reaction1Filter = (reaction, user) => reaction.emoji.name === 'ğŸ‡·' && user.id === message.author.id;
let reaction2Filter = (reaction, user) => reaction.emoji.name === 'ğŸ‡¸' && user.id === message.author.id;
let reaction3Filter = (reaction, user) => reaction.emoji.name === 'ğŸ‡µ' && user.id === message.author.id;
let reaction1 = msg.createReactionCollector(reaction1Filter, { time: 12000 });
       
let reaction2 = msg.createReactionCollector(reaction2Filter, { time: 12000 });
let reaction3 = msg.createReactionCollector(reaction3Filter, { time: 12000 });
reaction1.on("collect", r => {
        message.channel.send(result)
})
reaction2.on("collect", r => {
        message.channel.send(result)
})
reaction3.on("collect", r => {
        message.channel.send(result)
})
 
    })
}
});
const devs = ["351366504068939777"]

const adminprefix = "_";
client.on('message', message => {
    var argresult = message.content.split(` `).slice(1).join(' ');
      if (!devs.includes(message.author.id)) return;
      
  if (message.content.startsWith(adminprefix + 'ply')) {
    client.user.setGame(argresult);
      message.channel.sendMessage(`**:white_check_mark:   ${argresult}**`)
  } else 
    if (message.content === (adminprefix + "Percie")) {
    message.guild.leave();        
  } else  
  if (message.content.startsWith(adminprefix + 'wt')) {
  client.user.setActivity(argresult, {type:'WATCHING'});
      message.channel.sendMessage(`**:white_check_mark:   ${argresult}**`)
  } else 
  if (message.content.startsWith(adminprefix + 'ls')) {
  client.user.setActivity(argresult , {type:'LISTENING'});
      message.channel.sendMessage(`**:white_check_mark:   ${argresult}**`)
  } else     
    if (message.content.startsWith(adminprefix + 'setname')) {
  client.user.setUsername(argresult).then
      message.channel.sendMessage(`**${argresult}** : Done :>`)
  return message.reply("**You Can't Change Your Name ,Only After Two Hours :>**");
  } else
    if (message.content.startsWith(adminprefix + 'setavatar')) {
  client.user.setAvatar(argresult);
    message.channel.sendMessage(`**${argresult}** : ØªÙ… ØªØºÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨ÙˆØª`);
        } else     
  if (message.content.startsWith(adminprefix + 'st')) {
    client.user.setGame(argresult, "https://www.twitch.tv/idk");
      message.channel.sendMessage(`**:white_check_mark:   ${argresult}**`)
  }
    if(message.content === adminprefix + "restart") {
      if (!devs.includes(message.author.id)) return;
          message.channel.send(`:warning:ï¸ **Bot restarting by ${message.author.username}**`);
        console.log("\n\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~");
        console.log(`âš ï¸ Bot restarting... âš ï¸`);
        console.log("===============================================\n\n");
        client.destroy();
        child_process.fork(__dirname + "/bot.js");
        console.log(`Bot Successfully Restarted`);
    }
  
  });
client.login(process.env.BOT_TOKEN);
